"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(){function s(e,t){return e.getElementsByClassName(t)}function e(e){this.mobileSelect,this.wheelsData=e.wheels,this.jsonType=!1,this.cascadeJsonData=[],this.displayJson=[],this.curValue=null,this.curIndexArr=[],this.cascade=!1,this.startY,this.moveEndY,this.moveY,this.oldMoveY,this.offset=0,this.offsetSum=0,this.oversizeBorder,this.curDistance=[],this.clickStatus=!1,this.isPC=!0,this.init(e)}e.prototype={constructor:e,init:function(e){var n=this;if(n.keyMap=e.keyMap||{id:"id",value:"value",childs:"childs"},n.checkDataType(),n.renderWheels(n.wheelsData,e.cancelBtnText,e.ensureBtnText),n.trigger=document.querySelector(e.trigger),!n.trigger)return console.error("mobileSelect has been successfully installed, but no trigger found on your page."),!1;if(n.wheel=s(n.mobileSelect,"wheel"),n.slider=s(n.mobileSelect,"selectContainer"),n.wheels=n.mobileSelect.querySelector(".wheels"),n.liHeight=n.mobileSelect.querySelector("li").offsetHeight,n.ensureBtn=n.mobileSelect.querySelector(".ensure"),n.cancelBtn=n.mobileSelect.querySelector(".cancel"),n.grayLayer=n.mobileSelect.querySelector(".grayLayer"),n.popUp=n.mobileSelect.querySelector(".content"),n.callback=e.callback||function(){},n.transitionEnd=e.transitionEnd||function(){},n.onShow=e.onShow||function(){},n.onHide=e.onHide||function(){},n.initPosition=e.position||[],n.titleText=e.title||"",n.connector=e.connector||" ",n.triggerDisplayData=void 0===e.triggerDisplayData||e.triggerDisplayData,n.trigger.style.cursor="pointer",n.setStyle(e),n.setTitle(n.titleText),n.checkIsPC(),n.checkCascade(),n.addListenerAll(),n.cascade&&n.initCascade(),n.initPosition.length<n.slider.length)for(var t=n.slider.length-n.initPosition.length,i=0;i<t;i++)n.initPosition.push(0);n.setCurDistance(n.initPosition),n.cancelBtn.addEventListener("click",function(e){n.hide()}),n.ensureBtn.addEventListener("click",function(e){n.hide(),n.liHeight||(n.liHeight=n.mobileSelect.querySelector("li").offsetHeight);for(var t="",i=0;i<n.wheel.length;i++)i==n.wheel.length-1?t+=n.getInnerHtml(i):t+=n.getInnerHtml(i)+n.connector;n.triggerDisplayData&&(n.trigger.innerHTML=t),n.curIndexArr=n.getIndexArr(),n.curValue=n.getCurValue(),n.callback(n.curIndexArr,n.curValue)}),n.trigger.addEventListener("click",function(e){n.show()}),n.grayLayer.addEventListener("click",function(e){n.hide()}),n.popUp.addEventListener("click",function(e){e.stopPropagation()}),n.fixRowStyle()},setTitle:function(e){var t=this;t.titleText=e,t.mobileSelect.querySelector(".title").innerHTML=t.titleText},setStyle:function(e){var t=this;e.ensureBtnColor&&(t.ensureBtn.style.color=e.ensureBtnColor),e.cancelBtnColor&&(t.cancelBtn.style.color=e.cancelBtnColor),e.titleColor&&(t.title=t.mobileSelect.querySelector(".title"),t.title.style.color=e.titleColor),e.textColor&&(t.panel=t.mobileSelect.querySelector(".panel"),t.panel.style.color=e.textColor),e.titleBgColor&&(t.btnBar=t.mobileSelect.querySelector(".btnBar"),t.btnBar.style.backgroundColor=e.titleBgColor),e.bgColor&&(t.panel=t.mobileSelect.querySelector(".panel"),t.shadowMask=t.mobileSelect.querySelector(".shadowMask"),t.panel.style.backgroundColor=e.bgColor,t.shadowMask.style.background="linear-gradient(to bottom, "+e.bgColor+", rgba(255, 255, 255, 0), "+e.bgColor+")"),isNaN(e.maskOpacity)||(t.grayMask=t.mobileSelect.querySelector(".grayLayer"),t.grayMask.style.background="rgba(0, 0, 0, "+e.maskOpacity+")")},checkIsPC:function(){var e=navigator.userAgent.toLowerCase(),t="ipad"==e.match(/ipad/i),i="iphone os"==e.match(/iphone os/i),n="midp"==e.match(/midp/i),s="rv:1.2.3.4"==e.match(/rv:1.2.3.4/i),o="ucweb"==e.match(/ucweb/i),r="android"==e.match(/android/i),a="windows ce"==e.match(/windows ce/i),e="windows mobile"==e.match(/windows mobile/i);(t||i||n||s||o||r||a||e)&&(this.isPC=!1)},show:function(){this.mobileSelect.classList.add("mobileSelect-show"),"function"==typeof this.onShow&&this.onShow(this)},hide:function(){this.mobileSelect.classList.remove("mobileSelect-show"),"function"==typeof this.onHide&&this.onHide(this)},renderWheels:function(e,t,i){var n=this,t=t||"取消",i=i||"确认";n.mobileSelect=document.createElement("div"),n.mobileSelect.className="mobileSelect",n.mobileSelect.innerHTML='<div class="grayLayer"></div><div class="content"><div class="btnBar"><div class="fixWidth"><div class="cancel">'+t+'</div><div class="title"></div><div class="ensure">'+i+'</div></div></div><div class="panel"><div class="fixWidth"><div class="wheels"></div><div class="selectLine"></div><div class="shadowMask"></div></div></div></div>',document.body.appendChild(n.mobileSelect);for(var s="",o=0;o<e.length;o++){if(s+='<div class="wheel"><ul class="selectContainer">',n.jsonType)for(var r=0;r<e[o].data.length;r++)s+='<li data-id="'+e[o].data[r][n.keyMap.id]+'">'+e[o].data[r][n.keyMap.value]+"</li>";else for(r=0;r<e[o].data.length;r++)s+="<li>"+e[o].data[r]+"</li>";s+="</ul></div>"}n.mobileSelect.querySelector(".wheels").innerHTML=s},addListenerAll:function(){for(var e,t=this,i=0;i<t.slider.length;i++)e=i,t.addListenerWheel(t.wheel[e],e)},addListenerWheel:function(e,t){var i=this;e.addEventListener("touchstart",function(e){i.touch(e,this.firstChild,t)},!1),e.addEventListener("touchend",function(e){i.touch(e,this.firstChild,t)},!1),e.addEventListener("touchmove",function(e){i.touch(e,this.firstChild,t)},!1),i.isPC&&(e.addEventListener("mousedown",function(e){i.dragClick(e,this.firstChild,t)},!1),e.addEventListener("mousemove",function(e){i.dragClick(e,this.firstChild,t)},!1),e.addEventListener("mouseup",function(e){i.dragClick(e,this.firstChild,t)},!0))},checkDataType:function(){"object"==_typeof(this.wheelsData[0].data[0])&&(this.jsonType=!0)},checkCascade:function(){var e=this;if(e.jsonType){for(var t=e.wheelsData[0].data,i=0;i<t.length;i++)if(e.keyMap.childs in t[i]&&0<t[i][e.keyMap.childs].length){e.cascade=!0,e.cascadeJsonData=e.wheelsData[0].data;break}}else e.cascade=!1},generateArrData:function(e){for(var t=[],i=this.keyMap.id,n=this.keyMap.value,s=0;s<e.length;s++){var o={};o[i]=e[s][this.keyMap.id],o[n]=e[s][this.keyMap.value],t.push(o)}return t},initCascade:function(){var e=this;e.displayJson.push(e.generateArrData(e.cascadeJsonData)),0<e.initPosition.length?(e.initDeepCount=0,e.initCheckArrDeep(e.cascadeJsonData[e.initPosition[0]])):e.checkArrDeep(e.cascadeJsonData[0]),e.reRenderWheels()},initCheckArrDeep:function(e){var t,i=this;e&&i.keyMap.childs in e&&0<e[i.keyMap.childs].length&&(i.displayJson.push(i.generateArrData(e[i.keyMap.childs])),i.initDeepCount++,(t=e[i.keyMap.childs][i.initPosition[i.initDeepCount]])?i.initCheckArrDeep(t):i.checkArrDeep(e[i.keyMap.childs][0]))},checkArrDeep:function(e){var t=this;e&&t.keyMap.childs in e&&0<e[t.keyMap.childs].length&&(t.displayJson.push(t.generateArrData(e[t.keyMap.childs])),t.checkArrDeep(e[t.keyMap.childs][0]))},checkRange:function(e,t){for(var i,n=this,s=n.displayJson.length-1-e,o=0;o<s;o++)n.displayJson.pop();for(o=0;o<=e;o++)i=0==o?n.cascadeJsonData[t[0]]:i[n.keyMap.childs][t[o]];n.checkArrDeep(i),n.reRenderWheels(),n.fixRowStyle(),n.setCurDistance(n.resetPosition(e,t))},resetPosition:function(e,t){var i=t;if(this.slider.length>t.length)for(var n=this.slider.length-t.length,s=0;s<n;s++)i.push(0);else if(this.slider.length<t.length){n=t.length-this.slider.length;for(s=0;s<n;s++)i.pop()}for(s=e+1;s<i.length;s++)i[s]=0;return i},reRenderWheels:function(){var s=this;if(s.wheel.length>s.displayJson.length)for(var e=s.wheel.length-s.displayJson.length,t=0;t<e;t++)s.wheels.removeChild(s.wheel[s.wheel.length-1]);for(t=0;t<s.displayJson.length;t++)!function(e){var t="";if(s.wheel[e]){for(var i=0;i<s.displayJson[e].length;i++)t+='<li data-id="'+s.displayJson[e][i][s.keyMap.id]+'">'+s.displayJson[e][i][s.keyMap.value]+"</li>";s.slider[e].innerHTML=t}else{var n=document.createElement("div");n.className="wheel";for(t='<ul class="selectContainer">',i=0;i<s.displayJson[e].length;i++)t+='<li data-id="'+s.displayJson[e][i][s.keyMap.id]+'">'+s.displayJson[e][i][s.keyMap.value]+"</li>";n.innerHTML=t+="</ul>",s.addListenerWheel(n,e),s.wheels.appendChild(n)}}(t)},updateWheels:function(e){var t=this;if(t.cascade){if(t.cascadeJsonData=e,t.displayJson=[],t.initCascade(),t.initPosition.length<t.slider.length)for(var i=t.slider.length-t.initPosition.length,n=0;n<i;n++)t.initPosition.push(0);t.setCurDistance(t.initPosition),t.fixRowStyle()}},updateWheel:function(e,t){var i=this,n="";if(i.cascade)return console.error("级联格式不支持updateWheel(),请使用updateWheels()更新整个数据源"),!1;if(i.jsonType){for(var s=0;s<t.length;s++)n+='<li data-id="'+t[s][i.keyMap.id]+'">'+t[s][i.keyMap.value]+"</li>";i.wheelsData[e]={data:t}}else{for(s=0;s<t.length;s++)n+="<li>"+t[s]+"</li>";i.wheelsData[e]=t}i.slider[e].innerHTML=n},fixRowStyle:function(){for(var e=(100/this.wheel.length).toFixed(2),t=0;t<this.wheel.length;t++)this.wheel[t].style.width=e+"%"},getIndex:function(e){return Math.round((2*this.liHeight-e)/this.liHeight)},getIndexArr:function(){for(var e=[],t=0;t<this.curDistance.length;t++)e.push(this.getIndex(this.curDistance[t]));return e},getCurValue:function(){var e=this,t=[],i=e.getIndexArr();if(e.cascade)for(var n=0;n<e.wheel.length;n++)t.push(e.displayJson[n][i[n]]);else if(e.jsonType)for(n=0;n<e.curDistance.length;n++)t.push(e.wheelsData[n].data[e.getIndex(e.curDistance[n])]);else for(n=0;n<e.curDistance.length;n++)t.push(e.getInnerHtml(n));return t},getValue:function(){return this.curValue},calcDistance:function(e){return 2*this.liHeight-e*this.liHeight},setCurDistance:function(e){for(var t=this,i=[],n=0;n<t.slider.length;n++)i.push(t.calcDistance(e[n])),t.movePosition(t.slider[n],i[n]);t.curDistance=i},fixPosition:function(e){return-(this.getIndex(e)-2)*this.liHeight},movePosition:function(e,t){e.style.webkitTransform="translate3d(0,"+t+"px, 0)",e.style.transform="translate3d(0,"+t+"px, 0)"},locatePosition:function(e,t){this.curDistance[e]=this.calcDistance(t),this.movePosition(this.slider[e],this.curDistance[e]),this.cascade&&this.checkRange(e,this.getIndexArr())},updateCurDistance:function(e,t){e.style.transform?this.curDistance[t]=parseInt(e.style.transform.split(",")[1]):this.curDistance[t]=parseInt(e.style.webkitTransform.split(",")[1])},getDistance:function(e){return e.style.transform?parseInt(e.style.transform.split(",")[1]):parseInt(e.style.webkitTransform.split(",")[1])},getInnerHtml:function(e){var t=this.slider[e].getElementsByTagName("li").length,i=this.getIndex(this.curDistance[e]);return t<=i?i=t-1:i<0&&(i=0),this.slider[e].getElementsByTagName("li")[i].innerHTML},touch:function(e,t,i){var n,s=this;switch((e=e||window.event).type){case"touchstart":s.startY=e.touches[0].clientY,s.startY=parseInt(s.startY),s.oldMoveY=s.startY;break;case"touchend":s.moveEndY=parseInt(e.changedTouches[0].clientY),s.offsetSum=s.moveEndY-s.startY,s.oversizeBorder=-(t.getElementsByTagName("li").length-3)*s.liHeight,0==s.offsetSum?2==(n=parseInt((document.documentElement.clientHeight-s.moveEndY)/40))||(n=s.curDistance[i]+(n-2)*s.liHeight)<=2*s.liHeight&&n>=s.oversizeBorder&&(s.curDistance[i]=n,s.movePosition(t,s.curDistance[i]),s.transitionEnd(s.getIndexArr(),s.getCurValue())):(s.updateCurDistance(t,i),s.curDistance[i]=s.fixPosition(s.curDistance[i]),s.movePosition(t,s.curDistance[i]),s.curDistance[i]+s.offsetSum>2*s.liHeight?(s.curDistance[i]=2*s.liHeight,setTimeout(function(){s.movePosition(t,s.curDistance[i])},100)):s.curDistance[i]+s.offsetSum<s.oversizeBorder&&(s.curDistance[i]=s.oversizeBorder,setTimeout(function(){s.movePosition(t,s.curDistance[i])},100)),s.transitionEnd(s.getIndexArr(),s.getCurValue())),s.cascade&&s.checkRange(i,s.getIndexArr());break;case"touchmove":e.preventDefault(),s.moveY=e.touches[0].clientY,s.offset=s.moveY-s.oldMoveY,s.updateCurDistance(t,i),s.curDistance[i]=s.curDistance[i]+s.offset,s.movePosition(t,s.curDistance[i]),s.oldMoveY=s.moveY}},dragClick:function(e,t,i){var n,s=this;switch((e=e||window.event).type){case"mousedown":s.startY=e.clientY,s.oldMoveY=s.startY,s.clickStatus=!0;break;case"mouseup":s.moveEndY=e.clientY,s.offsetSum=s.moveEndY-s.startY,s.oversizeBorder=-(t.getElementsByTagName("li").length-3)*s.liHeight,0==s.offsetSum?2==(n=parseInt((document.documentElement.clientHeight-s.moveEndY)/40))||(n=s.curDistance[i]+(n-2)*s.liHeight)<=2*s.liHeight&&n>=s.oversizeBorder&&(s.curDistance[i]=n,s.movePosition(t,s.curDistance[i]),s.transitionEnd(s.getIndexArr(),s.getCurValue())):(s.updateCurDistance(t,i),s.curDistance[i]=s.fixPosition(s.curDistance[i]),s.movePosition(t,s.curDistance[i]),s.curDistance[i]+s.offsetSum>2*s.liHeight?(s.curDistance[i]=2*s.liHeight,setTimeout(function(){s.movePosition(t,s.curDistance[i])},100)):s.curDistance[i]+s.offsetSum<s.oversizeBorder&&(s.curDistance[i]=s.oversizeBorder,setTimeout(function(){s.movePosition(t,s.curDistance[i])},100)),s.transitionEnd(s.getIndexArr(),s.getCurValue())),s.clickStatus=!1,s.cascade&&s.checkRange(i,s.getIndexArr());break;case"mousemove":e.preventDefault(),s.clickStatus&&(s.moveY=e.clientY,s.offset=s.moveY-s.oldMoveY,s.updateCurDistance(t,i),s.curDistance[i]=s.curDistance[i]+s.offset,s.movePosition(t,s.curDistance[i]),s.oldMoveY=s.moveY)}}},"object"==("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=e:"function"==typeof define&&define.amd?define([],function(){return e}):window.MobileSelect=e}();
//# sourceMappingURL=mobileSelect.min.js.map
